(this["webpackJsonpreact-sku"]=this["webpackJsonpreact-sku"]||[]).push([[0],{162:function(e,n,t){},163:function(e,n,t){},287:function(e,n,t){},291:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(32),l=t.n(c),i=(t(162),t(82)),u=t(43),o=t(38),s=t(49),d=(t(163),t(80)),v=t(296),f=t(295),m=t(298),p=t(294),h=function(e,n){var t;return(t=[]).concat.apply(t,Object(u.a)(e.map((function(e){return n.map((function(n){return[].concat(e,n)}))}))))},E=function e(n,t){for(var a=arguments.length,r=new Array(a>2?a-2:0),c=2;c<a;c++)r[c-2]=arguments[c];return t?e.apply(void 0,[h(n,t)].concat(r)):n},b=t(76),g=t.n(b),O=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)}))},k=d.a.Option,j=function(e){var n,t,c=e.skus,l=e.onChange,i=[];null===c||void 0===c||c.forEach((function(e){var a;null===(a=e.properties)||void 0===a||a.forEach((function(e,n){if(e.name&&e.value){var t,a,r=i.find((function(n){return n.name===e.name}));if(r)!(null===(t=r.values)||void 0===t?void 0:t.includes(e.value))&&(null===(a=r.values)||void 0===a||a.push(e.value));else i.push({name:e.name,key:O(),values:[e.value]})}})),1===c.length&&(n=e.price,t=e.hold)}));var h=Object(a.useState)(i),b=Object(o.a)(h,2),j=b[0],x=b[1],y=Object(a.useState)(!1),N=Object(o.a)(y,2),C=N[0],S=N[1],w=Object(a.useState)([]),I=Object(o.a)(w,2),J=I[0],P=I[1],F=Object(a.useState)(null!==c&&void 0!==c?c:[]),q=Object(o.a)(F,2),V=q[0],A=q[1],B={add:function(){x((function(e){return[].concat(Object(u.a)(e),[{name:"",key:O(),values:[]}])}))},remove:function(e){x((function(n){var t=JSON.parse(JSON.stringify(n));return t.splice(e,1),t}))},onChangeName:function(e,n){x((function(t){var a=Object(u.a)(t);return a[e].name=n,a}))},onChangeValues:function(e,n){x((function(t){var a=Object(u.a)(t);return a[e].values=n,a}))}},L=function(e,n){A((function(t){return e.price=n,JSON.parse(JSON.stringify(t))}))},M=function(e,n){A((function(t){return e.hold=Number(n),JSON.parse(JSON.stringify(t))}))};return Object(a.useEffect)((function(){var e=!1,n=[],t=[],a=[];j.forEach((function(t){var r;if(t.name&&(null===(r=t.values)||void 0===r?void 0:r.length)){var c=[];e=!0,n.push({title:t.name,dataIndex:"properties",key:"properties",render:function(e,n,a){var r=e.find((function(e){return e.name===t.name}));return null===r||void 0===r?void 0:r.value}}),t.values.forEach((function(e){c.push({name:t.name,value:e})})),a.push(c)}}));var c=E.apply(void 0,a);null===c||void 0===c||c.forEach((function(e,n){t.push({key:n,skuId:O(),properties:Array.isArray(e)?e:[e]})})),n.push({title:"\u4ef7\u683c",dataIndex:"price",key:"price",width:200,render:function(e,n,t){return r.a.createElement(v.a,{value:e,prefix:"\uffe5",required:!0,onChange:function(e){return L(n,e.target.value)}})}}),n.push({title:"\u5e93\u5b58",width:200,dataIndex:"hold",key:"hold",render:function(e,n,t){return r.a.createElement(v.a,{value:e,required:!0,onChange:function(e){return M(n,e.target.value)}})}}),S(e),P(n),g.a.isEqual(j,i)||A(t)}),[j]),Object(a.useEffect)((function(){null===l||void 0===l||l(V)}),[V]),r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a.Item,{label:"\u5546\u54c1\u89c4\u683c",wrapperCol:{span:18}},r.a.createElement(m.b,{direction:"vertical"},j.map((function(e,n){var t;return r.a.createElement(m.b,{key:e.key},r.a.createElement(v.a,{addonBefore:"\u89c4\u683c\u540d",defaultValue:e.name,onChange:function(e){return B.onChangeName(n,e.target.value)}}),r.a.createElement(d.a,{mode:"tags",style:{width:400},placeholder:"\u6dfb\u52a0\u89c4\u683c\u5c5e\u6027",value:e.values,onChange:function(e){return B.onChangeValues(n,e)}},null===e||void 0===e||null===(t=e.values)||void 0===t?void 0:t.map((function(e){return r.a.createElement(k,{key:e,value:e},e)}))),r.a.createElement(s.a,{type:"link",danger:!0,onClick:function(){return B.remove(n)}},"\u5220\u9664"))})),j.length<10&&r.a.createElement(s.a,{type:"dashed",onClick:B.add},"\u6dfb\u52a0\u89c4\u683c"))),C?r.a.createElement(f.a.Item,{label:"\u89c4\u683c\u660e\u7ec6",wrapperCol:{span:16}},r.a.createElement(p.a,{pagination:!1,size:"small",columns:J,dataSource:V,bordered:!0})):r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a.Item,{label:"\u4ef7\u683c",name:"price",wrapperCol:{span:2},initialValue:n,rules:[{required:!0,message:"\u4ef7\u683c\u4e0d\u80fd\u4e3a\u7a7a"}]},r.a.createElement(v.a,{prefix:"\uffe5"})),r.a.createElement(f.a.Item,{label:"\u5e93\u5b58",name:"hold",initialValue:t,wrapperCol:{span:2},rules:[{required:!C,message:"\u5e93\u5b58\u4e0d\u80fd\u4e3a\u7a7a"}]},r.a.createElement(v.a,null))))},x=t(297),y=(t(287),0),N=function(e){var n=e.data,t=e.optionsChange,c=e.onPressConfirm,l=Object(a.useState)(1),s=Object(o.a)(l,2),d=s[0],v=s[1],f=Object(a.useState)({}),m=Object(o.a)(f,2),p=m[0],h=m[1],E=Object(a.useState)(!1),b=Object(o.a)(E,2),O=b[0],k=b[1],j=Object(a.useState)(0),N=Object(o.a)(j,2),C=N[0],S=N[1],w=Object(a.useState)(0),I=Object(o.a)(w,2),J=I[0],P=I[1],F=Object(a.useState)(0),q=Object(o.a)(F,2),V=q[0],A=q[1],B=function(e,t){var a=[];if(Object.keys(e).forEach((function(n){var t=e[n].find((function(e){return e.select}));t&&a.push({name:n,value:t.value})})),a.length===Object.keys(e).length){var r=n.skus.find((function(e){return!g.a.xorWith(a,e.properties,g.a.isEqual).length}));return r&&r[null!==t&&void 0!==t?t:""]?r[null!==t&&void 0!==t?t:""]:r||null}},L=function(e){var n,t,a=Object.keys(p),r=a.filter((function(e){return p[e].find((function(e){return e.select}))})).length===a.length;if(e&&e.length||(r=!1),1===(null===e||void 0===e?void 0:e.length)&&!(null===(n=e[0])||void 0===n||null===(t=n.properties)||void 0===t?void 0:t.length)&&e[0].hold<=0&&(r=!1),r){var c=B(p,"hold");d>c&&v(c)}return k(r),r},M=function(e){var t=n.skus;Object.keys(e).forEach((function(n){e[n].forEach((function(e){var a="".concat(n,":").concat(e.value),r=t.find((function(e){return e.properties.find((function(e){return"".concat(e.name,":").concat(e.value)===a}))&&e.hold}));e.disable=!r}))})),h(Object(i.a)({},e))},T=function(e,a){var r,c=!1;v(1);var l=(p[Object.keys(p).find((function(n){return n===e}))||""]||[]).find((function(e){return e.select}))||{};l.select=!1,l===a?c=!0:a.select=!0;var o=Object.keys(p).filter((function(e){return p[e].find((function(e){return e.select}))})).reduce((function(e,n){var t;return[].concat(Object(u.a)(e),["".concat(n,":").concat(null===(t=p[n].find((function(e){return e.select})))||void 0===t?void 0:t.value)])}),[]);c&&(o.length||M(p)),o.length&&function(e){var t=n.skus;Object.keys(p).forEach((function(n){var a=p[Object.keys(p).find((function(e){return n===e}))||""].find((function(e){return e.select}));p[n].forEach((function(r){if(!r.select){var c=Object(u.a)(e);if(a){var l=c.findIndex((function(e){return e==="".concat(n,":").concat(a.value)}));c.splice(l,1)}c.push("".concat(n,":").concat(r.value));var i=[];t.forEach((function(e){c.filter((function(n){return!!e.properties.find((function(e){return"".concat(e.name,":").concat(e.value)===n}))})).length===c.length&&i.push(e)}));var o=i.find((function(e){return e.hold})),s=o?o.hold:0;r.disable=!s}}))})),L(t)}(o);var s=null;s=o.length?B(p,"price"):null===n||void 0===n?void 0:n.minPrice;var d=null!==(r=B(p,"hold"))&&void 0!==r?r:y;h(Object(i.a)({},p)),s&&S(s),P(d),t&&t(p)},z=function(e){var n=d;if("-"===e&&n>1)--n;else if("+"===e)if(O){var t=B(p,"hold");n<t?++n:(x.b.warning("\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e\u5e93\u5b58"),n=t)}else++n;v(n)};return Object(a.useEffect)((function(){!function(){var e,t,a,r=null===n||void 0===n?void 0:n.skus,c=null===n||void 0===n?void 0:n.spec,l=n.skuHold,i={},u=null!==(e=null===n||void 0===n?void 0:n.minPrice)&&void 0!==e?e:0;if(c)i=c,P(l);else{var o={},s=0;null===r||void 0===r||r.forEach((function(e){var n;s+=e.hold,null===e||void 0===e||null===(n=e.properties)||void 0===n||n.forEach((function(e){i[e.name]||(i[e.name]=[],o[e.name]=[]),o[e.name].includes(e.value)||(o[e.name].push(e.value),i[e.name].push({value:e.value,disable:!1,select:!1}))})),e.price>u&&(u=e.price)})),P(s),y=s}var d=!!n.canFlag;1===(null===r||void 0===r?void 0:r.length)&&!(null===(t=r[0].properties)||void 0===t?void 0:t.length)&&r[0].hold<=0&&(d=!1),k(d),S(null!==(a=null===n||void 0===n?void 0:n.minPrice)&&void 0!==a?a:0),A(u),M(i)}(),v((null===n||void 0===n?void 0:n.count)||1)}),[n]),r.a.createElement("div",{className:"drawer-inner"},r.a.createElement("div",{className:"prod-info"},r.a.createElement("div",{className:"prod-img"},r.a.createElement("img",{alt:"",src:n.image})),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"item-title"},n.title),r.a.createElement("div",null,r.a.createElement("div",{className:"price-wrap"},r.a.createElement("span",null,"\xa5",C),!O&&V>C?r.a.createElement("span",null,"~ ",V):null),r.a.createElement("div",{className:"sku-hold"},"\u5e93\u5b58 ",J," \u4ef6")))),r.a.createElement("div",{className:"spec-inner"},Object.keys(p).map((function(e,n){return r.a.createElement("div",{key:"".concat(n+1),className:"items"},r.a.createElement("div",{className:"title"},e),r.a.createElement("div",{className:"tags"},p[e].map((function(t,a){return r.a.createElement("div",{key:"".concat(n+a),onClick:function(){return!t.disable&&T(e,t)},className:t.select?"tag active":t.disable?"tag disable":"tag"},t.value)}))))})),r.a.createElement("div",{className:"items"},r.a.createElement("div",{className:"title"},"\u6570\u91cf",r.a.createElement("div",{className:"count-wrap"},r.a.createElement("div",{className:"sign",onClick:function(){return z("-")}},"-"),r.a.createElement("div",{className:"count-box"},d),r.a.createElement("div",{className:"sign",onClick:function(){return z("+")}},"+")))),r.a.createElement("div",{className:"btn-wrap"},r.a.createElement("div",{className:O?"btn":"btn disable",onClick:function(){if(L(null===n||void 0===n?void 0:n.skus)){var e={skuId:B(p,"skuId"),itemId:null===n||void 0===n?void 0:n.itemId,num:d};null===c||void 0===c||c(e)}}},"\u786e\u8ba4"))))},C=[],S={title:"react-sku\u7ec4\u4ef6",minPrice:1,itemId:"test_csdfdge8je3nnc"},w=function(){var e=Object(a.useState)([]),n=Object(o.a)(e,2),t=n[0],c=n[1];return r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"sku-creator-wrap"},r.a.createElement(j,{onChange:function(e){C=e},skus:[]}),r.a.createElement(s.a,{onClick:function(){c(Object(u.a)(C))}},"\u6dfb\u52a0")),r.a.createElement("div",{style:{background:"#f7f7f7"}},r.a.createElement("div",{className:"sku-select-wrap"},r.a.createElement(N,{optionsChange:function(e){console.log("\u70b9\u51fb\u7684\u89c4\u683c\u5c5e\u6027\u53d8\u5316",e)},onPressConfirm:function(e){console.info("\u63d0\u4ea4\u7684\u6570\u636e",e)},data:Object(i.a)({skus:t},S)}))))},I=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,299)).then((function(n){var t=n.getCLS,a=n.getFID,r=n.getFCP,c=n.getLCP,l=n.getTTFB;t(e),a(e),r(e),c(e),l(e)}))};t(290);l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(w,null)),document.getElementById("root")),I()}},[[291,1,2]]]);
//# sourceMappingURL=main.601c94b9.chunk.js.map