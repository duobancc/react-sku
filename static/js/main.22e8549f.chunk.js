(this["webpackJsonpreact-sku"]=this["webpackJsonpreact-sku"]||[]).push([[0],{162:function(e,n,t){},163:function(e,n,t){},287:function(e,n,t){},291:function(e,n,t){"use strict";t.r(n);var a=t(0),c=t.n(a),r=t(32),i=t.n(r),l=(t(162),t(82)),u=t(43),o=t(38),s=t(49),d=(t(163),t(80)),v=t(296),f=t(295),m=t(298),p=t(294),h=function(e,n){var t;return(t=[]).concat.apply(t,Object(u.a)(e.map((function(e){return n.map((function(n){return[].concat(e,n)}))}))))},b=function e(n,t){for(var a=arguments.length,c=new Array(a>2?a-2:0),r=2;r<a;r++)c[r-2]=arguments[r];return t?e.apply(void 0,[h(n,t)].concat(c)):n},E=t(76),g=t.n(E),O=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)}))},k=d.a.Option,j=function(e){var n=e.skus,t=e.onChange,r=[];null===n||void 0===n||n.forEach((function(e){var t;null===(t=e.properties)||void 0===t||t.forEach((function(e,n){if(e.name&&e.value){var t,a,c=r.find((function(n){return n.name===e.name}));if(c)!(null===(t=c.values)||void 0===t?void 0:t.includes(e.value))&&(null===(a=c.values)||void 0===a||a.push(e.value));else r.push({name:e.name,key:O(),values:[e.value]})}})),1===n.length&&(e.price,e.hold)}));var i=Object(a.useState)(r),l=Object(o.a)(i,2),h=l[0],E=l[1],j=Object(a.useState)(!1),x=Object(o.a)(j,2),y=x[0],N=x[1],C=Object(a.useState)([]),S=Object(o.a)(C,2),w=S[0],I=S[1],J=Object(a.useState)(null!==n&&void 0!==n?n:[]),P=Object(o.a)(J,2),F=P[0],q=P[1],A={add:function(){E((function(e){return[].concat(Object(u.a)(e),[{name:"",key:O(),values:[]}])}))},remove:function(e){E((function(n){var t=JSON.parse(JSON.stringify(n));return t.splice(e,1),t}))},onChangeName:function(e,n){E((function(t){var a=Object(u.a)(t);return a[e].name=n,a}))},onChangeValues:function(e,n){E((function(t){var a=Object(u.a)(t);return a[e].values=n,a}))}},B=function(e,n){q((function(t){return e.price=n,JSON.parse(JSON.stringify(t))}))},V=function(e,n){q((function(t){return e.hold=Number(n),JSON.parse(JSON.stringify(t))}))};return Object(a.useEffect)((function(){var e=!1,n=[],t=[],a=[];h.forEach((function(t){var c;if(t.name&&(null===(c=t.values)||void 0===c?void 0:c.length)){var r=[];e=!0,n.push({title:t.name,dataIndex:"properties",key:"properties",render:function(e,n,a){var c=e.find((function(e){return e.name===t.name}));return null===c||void 0===c?void 0:c.value}}),t.values.forEach((function(e){r.push({name:t.name,value:e})})),a.push(r)}}));var i=b.apply(void 0,a);null===i||void 0===i||i.forEach((function(e,n){t.push({key:n,skuId:O(),properties:Array.isArray(e)?e:[e]})})),n.push({title:"\u4ef7\u683c",dataIndex:"price",key:"price",width:200,render:function(e,n,t){return c.a.createElement(v.a,{value:e,prefix:"\uffe5",required:!0,onChange:function(e){return B(n,e.target.value)}})}}),n.push({title:"\u5e93\u5b58",width:200,dataIndex:"hold",key:"hold",render:function(e,n,t){return c.a.createElement(v.a,{value:e,required:!0,onChange:function(e){return V(n,e.target.value)}})}}),N(e),I(n),g.a.isEqual(h,r)||q(t)}),[h]),Object(a.useEffect)((function(){null===t||void 0===t||t(F)}),[F]),c.a.createElement(c.a.Fragment,null,c.a.createElement(f.a.Item,{label:"\u5546\u54c1\u89c4\u683c",wrapperCol:{span:18}},c.a.createElement(m.b,{direction:"vertical"},h.map((function(e,n){var t;return c.a.createElement(m.b,{key:e.key},c.a.createElement(v.a,{addonBefore:"\u89c4\u683c\u540d",defaultValue:e.name,onChange:function(e){return A.onChangeName(n,e.target.value)}}),c.a.createElement(d.a,{mode:"tags",style:{width:400},placeholder:"\u6dfb\u52a0\u89c4\u683c\u5c5e\u6027",value:e.values,onChange:function(e){return A.onChangeValues(n,e)}},null===e||void 0===e||null===(t=e.values)||void 0===t?void 0:t.map((function(e){return c.a.createElement(k,{key:e,value:e},e)}))),c.a.createElement(s.a,{type:"link",danger:!0,onClick:function(){return A.remove(n)}},"\u5220\u9664"))})),h.length<10&&c.a.createElement(s.a,{type:"dashed",onClick:A.add},"\u6dfb\u52a0\u89c4\u683c"))),y?c.a.createElement(f.a.Item,{label:"\u89c4\u683c\u660e\u7ec6",wrapperCol:{span:16}},c.a.createElement(p.a,{pagination:!1,size:"small",columns:w,dataSource:F,bordered:!0})):null)},x=t(297),y=(t(287),0),N=function(e){var n=e.data,t=e.optionsChange,r=e.onPressConfirm,i=Object(a.useState)(1),s=Object(o.a)(i,2),d=s[0],v=s[1],f=Object(a.useState)({}),m=Object(o.a)(f,2),p=m[0],h=m[1],b=Object(a.useState)(!1),E=Object(o.a)(b,2),O=E[0],k=E[1],j=Object(a.useState)(0),N=Object(o.a)(j,2),C=N[0],S=N[1],w=Object(a.useState)(0),I=Object(o.a)(w,2),J=I[0],P=I[1],F=Object(a.useState)(0),q=Object(o.a)(F,2),A=q[0],B=q[1],V=function(e,t){var a=[];if(Object.keys(e).forEach((function(n){var t=e[n].find((function(e){return e.select}));t&&a.push({name:n,value:t.value})})),a.length===Object.keys(e).length){var c=n.skus.find((function(e){return!g.a.xorWith(a,e.properties,g.a.isEqual).length}));return c&&c[null!==t&&void 0!==t?t:""]?c[null!==t&&void 0!==t?t:""]:c||null}},L=function(e){var n,t,a=Object.keys(p),c=a.filter((function(e){return p[e].find((function(e){return e.select}))})).length===a.length;if(e&&e.length||(c=!1),1===(null===e||void 0===e?void 0:e.length)&&!(null===(n=e[0])||void 0===n||null===(t=n.properties)||void 0===t?void 0:t.length)&&e[0].hold<=0&&(c=!1),c){var r=V(p,"hold");d>r&&v(r)}return k(c),c},M=function(e){var t=n.skus;Object.keys(e).forEach((function(n){e[n].forEach((function(e){var a="".concat(n,":").concat(e.value),c=t.find((function(e){return e.properties.find((function(e){return"".concat(e.name,":").concat(e.value)===a}))&&e.hold}));e.disable=!c}))})),h(Object(l.a)({},e))},T=function(e,a){var c,r=!1;v(1);var i=(p[Object.keys(p).find((function(n){return n===e}))||""]||[]).find((function(e){return e.select}))||{};i.select=!1,i===a?r=!0:a.select=!0;var o=Object.keys(p).filter((function(e){return p[e].find((function(e){return e.select}))})).reduce((function(e,n){var t;return[].concat(Object(u.a)(e),["".concat(n,":").concat(null===(t=p[n].find((function(e){return e.select})))||void 0===t?void 0:t.value)])}),[]);r&&(o.length||M(p)),o.length&&function(e,t){var a=n.skus;Object.keys(p).forEach((function(n){if(n!==t){var c=p[Object.keys(p).find((function(e){return n===e}))||""].find((function(e){return e.select}));p[n].forEach((function(t){if(!t.select){var r=Object(u.a)(e);if(c){var i=r.findIndex((function(e){return e==="".concat(n,":").concat(c.value)}));r.splice(i,1)}r.push("".concat(n,":").concat(t.value));var l=[];a.forEach((function(e){r.filter((function(n){return!!e.properties.find((function(e){return"".concat(e.name,":").concat(e.value)===n}))})).length===r.length&&l.push(e)}));var o=l.find((function(e){return e.hold})),s=o?o.hold:0;t.disable=!s}}))}})),L(a)}(o,e);var s=null;s=o.length?V(p,"price"):null===n||void 0===n?void 0:n.minPrice;var d=null!==(c=V(p,"hold"))&&void 0!==c?c:y;h(Object(l.a)({},p)),s&&S(s),P(d),t&&t(p)},z=function(e){var n=d;if("-"===e&&n>1)--n;else if("+"===e)if(O){var t=V(p,"hold");n<t?++n:(x.b.warning("\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e\u5e93\u5b58"),n=t)}else++n;v(n)};return Object(a.useEffect)((function(){!function(){var e,t,a,c=null===n||void 0===n?void 0:n.skus,r=null===n||void 0===n?void 0:n.spec,i=n.skuHold,l={},u=null!==(e=null===n||void 0===n?void 0:n.minPrice)&&void 0!==e?e:0;if(r)l=r,P(i);else{var o={},s=0;null===c||void 0===c||c.forEach((function(e){var n;s+=e.hold,null===e||void 0===e||null===(n=e.properties)||void 0===n||n.forEach((function(e){l[e.name]||(l[e.name]=[],o[e.name]=[]),o[e.name].includes(e.value)||(o[e.name].push(e.value),l[e.name].push({value:e.value,disable:!1,select:!1}))})),e.price>u&&(u=e.price)})),P(s),y=s}var d=!!n.canFlag;1===(null===c||void 0===c?void 0:c.length)&&!(null===(t=c[0].properties)||void 0===t?void 0:t.length)&&c[0].hold<=0&&(d=!1),k(d),S(null!==(a=null===n||void 0===n?void 0:n.minPrice)&&void 0!==a?a:0),B(u),M(l)}(),v((null===n||void 0===n?void 0:n.count)||1)}),[n]),c.a.createElement("div",{className:"drawer-inner"},c.a.createElement("div",{className:"prod-info"},c.a.createElement("div",{className:"prod-img"},c.a.createElement("img",{alt:"",src:n.image})),c.a.createElement("div",{className:"content"},c.a.createElement("div",{className:"item-title"},n.title),c.a.createElement("div",null,c.a.createElement("div",{className:"price-wrap"},c.a.createElement("span",null,"\xa5",C),!O&&A>C?c.a.createElement("span",null,"~ ",A):null),c.a.createElement("div",{className:"sku-hold"},"\u5e93\u5b58 ",J," \u4ef6")))),c.a.createElement("div",{className:"spec-inner"},Object.keys(p).map((function(e,n){return c.a.createElement("div",{key:"".concat(n+1),className:"items"},c.a.createElement("div",{className:"title"},e),c.a.createElement("div",{className:"tags"},p[e].map((function(t,a){return c.a.createElement("div",{key:"".concat(n+a),onClick:function(){return!t.disable&&T(e,t)},className:t.select?"tag active":t.disable?"tag disable":"tag"},t.value)}))))})),c.a.createElement("div",{className:"items"},c.a.createElement("div",{className:"title"},"\u6570\u91cf",c.a.createElement("div",{className:"count-wrap"},c.a.createElement("div",{className:"sign",onClick:function(){return z("-")}},"-"),c.a.createElement("div",{className:"count-box"},d),c.a.createElement("div",{className:"sign",onClick:function(){return z("+")}},"+")))),c.a.createElement("div",{className:"btn-wrap"},c.a.createElement("div",{className:O?"btn":"btn disable",onClick:function(){if(L(null===n||void 0===n?void 0:n.skus)){var e={skuId:V(p,"skuId"),itemId:null===n||void 0===n?void 0:n.itemId,num:d};null===r||void 0===r||r(e)}}},"\u786e\u8ba4"))))},C=[],S={title:"react-sku\u7ec4\u4ef6",minPrice:1,itemId:"test_csdfdge8je3nnc"},w=function(){var e=Object(a.useState)([]),n=Object(o.a)(e,2),t=n[0],r=n[1];return c.a.createElement("div",{className:"app"},c.a.createElement("div",{className:"sku-creator-wrap"},c.a.createElement(j,{onChange:function(e){C=e},skus:[]}),c.a.createElement(s.a,{type:"primary",onClick:function(){r(Object(u.a)(C))}},"\u786e\u8ba4\u6dfb\u52a0")),c.a.createElement("div",{style:{background:"#f7f7f7"}},c.a.createElement("div",{className:"sku-select-wrap"},c.a.createElement(N,{optionsChange:function(e){console.log("\u70b9\u51fb\u7684\u89c4\u683c\u5c5e\u6027\u53d8\u5316",e)},onPressConfirm:function(e){console.info("\u63d0\u4ea4\u7684\u6570\u636e",e)},data:Object(l.a)({skus:t},S)}))))},I=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,299)).then((function(n){var t=n.getCLS,a=n.getFID,c=n.getFCP,r=n.getLCP,i=n.getTTFB;t(e),a(e),c(e),r(e),i(e)}))};t(290);i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(w,null)),document.getElementById("root")),I()}},[[291,1,2]]]);
//# sourceMappingURL=main.22e8549f.chunk.js.map